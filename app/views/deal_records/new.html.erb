


<%= form_tag deal_records_path do %>
<div class="deal-record-new">
		<div class="submit">
			<%= submit_tag "儲存這筆記錄" %>
		</div>

		<div class="record-field">
			<div class="record-field-unit">
				<div class="title">
					交易日期
				</div>
				<div class="input">
					<%= select :deal_record, :date, options_for_select(day_list,0.day.ago) %>			
				</div>
			</div>
			
			<div class="record-field-unit">
				<div class="title">
					地點
				</div>
				<div class="input">
					<%= text_field :deal_record, :location, :value=>@deal_record.location %>
				</div>
			</div>
			
			<div class="record-field-unit">
				<div class="title">
					說明
				</div>
				<div class="input">
					<%= text_field :deal_record, :description, :value=>@deal_record.description %>
				</div>
			</div>

			<div class="record-field-unit">
				<div class="title"> 總金額 </div>
				<div class="total-amount">
					0
				</div>
			</div>
		</div>

		<div class="deal-item-field-group attribute-field-group">
			<div class="deal-item-field-group-title">
				明細 
			</div>

			<% @deal_record.deal_items.each_with_index do |deal_item,index| %>	
				<% object_name = "deal_record[deal_items_attributes][#{index}]" %>
				<div class="deal-item-field attribute-field">
					明細
					<%= hidden_field object_name,:id, :value=> deal_item.id %>
					<%= link_to "x","", :onClick=>"vAttributeRemoveRow(event,this)", :class=>"remove" %>

					<div class="deal-item-field-unit">
						<div class="title">
							金額
						</div>	
						<div class="input">
							<%= number_field object_name,:amount, :value=>deal_item.amount %>	
						</div>
					</div>

					<div class="deal-item-field-unit">
						<div class="title">
							主項目
						</div>	
						<div class="input">
							<%= select object_name, :first_category_id, options_for_select(FirstCategory.all.map{|fc| [fc.name,fc.id]}, deal_item.first_category_id) %>
						</div>
					</div>

					<div class="deal-item-field-unit">
						<div class="title">
							次項目
						</div>	
						<div class="input">
							<%= select object_name, :second_category_id, options_for_select(SecondCategory.all.map{|fc| [fc.name,fc.id]}, deal_item.second_category_id) %>						
						</div>
					</div>					
		
					<div class="deal-item-field-unit">
						<div class="title">
							描述
						</div>	
						<div class="input">
							<%= text_field object_name,:description, :value=>deal_item.description %>							
						</div>
					</div>	

					<div class="deal-item-field-payment">
						<div class="deal-item-field-payment-title">
							交易方式
						</div>	

						<div class="deal-payment-field-group payment-field-group">
						<% deal_item.deal_payments.each_with_index do |deal_payment,subindex| %>
							<% payment_name = "#{object_name}[deal_payments_attributes][#{subindex}]" %>
							<div class="payment-field">
								<%= hidden_field payment_name, :id, :value=> deal_payment.id %>
								
								<div class="payment-field-unit">
									<div class="title"> 交易帳號 </div>
									<div class="input">
										<%= select payment_name, :account_entity_id, options_for_select(AccountEntity.all.map{|entity| ["#{entity.account_owner.name}-#{entity.name}",entity.id]},deal_payment.id) %>									
									</div>
								</div>

								<div class="payment-field-unit">
									<div class="title"> 金額 </div>
									<div class="input">
											<%= number_field payment_name, :amount, :value=>deal_payment.amount %>
									</div>
								</div>

								<%= link_to "xx","", :onClick=>"vAttributeRemoveRow(event,this)", :class=>"remove" %>
							</div> <%# payment-field %>
							<%= link_to "++","", :onClick=>"vAttributeAddRow(event,this)", :class=>"btn btn-default btn-xs" %>
							<% end %>									
						</div>

					</div>	<%# deal-item-field-payment %>
				</div>	<%# attribute-field %>
			<% end %>
			<%= link_to "+","", :onClick=>"vAttributeAddRow(event,this)", :class=>"btn btn-default btn-xs" %>
		</div>


</div>

<% end %>
